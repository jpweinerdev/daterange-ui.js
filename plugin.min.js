/*!
 * daterange-ui.js 1.0.0
 * https://github.com/jpweinerdev/daterange-ui.js
 *
 * @license MIT (https://github.com/jpweinerdev/daterange-ui.js/blob/master/LICENSE)
 *
 * @copyright 2021 http://developer.jpweiner.net/daterange.html - A project by Jean-Pierre Weiner - Developer
 */

(function(a,b,c,e){"use strict";var f=Math.floor;function g(b,c){var d=this;this.element=b,this.settings=a.extend({},h,c),this._defaults=h,this._name="daterangeselect",this.update=function(a){d.settings.data=a,d.drawAndUpdate()},j.updateSelectedRange=function(){"function"==typeof d.settings.onRangeUpdate&&d.settings.onRangeUpdate(j.getRange())},"function"==typeof d.settings.hoverText&&(j.hoverText=function(){var a=j.getCurrentBarData();return d.settings.hoverText(a)}),this.init()}var h={container:"#graph",height:320,rangeBarOpacity:.4,handleScaleFactor:1.6,dataLengthTrigger:30},j={selectedRange:[],currentBarData:{},setRange:function(a,b){this.selectedRange=[a,b]},getRange:function(){return this.selectedRange},clearRange:function(){this.selectedRange=[]},setCurrentBarData:function(a){this.currentBarData=a},getCurrentBarData:function(){return this.currentBarData},updateSelectedRange:function(){return this.getRange()},hoverText:function(){return this.getCurrentBarData().key_as_string},updateGraphSettings:function(a){"object"==typeof a&&(this.graph.container=a.container,this.graph.height=a.height,this.graph.slider.rangeBarOpacity=a.rangeBarOpacity,this.graph.slider.handleScaleFactor=a.handleScaleFactor,this.graph.dataLengthTrigger=a.dataLengthTrigger)},graph:{container:"#graph",height:320,svg:"undefined",svgg:"undefined",data:"undefined",datasetSize:100,dataLengthTrigger:30,xAxis:"undefined",dates:[],getDimensions:function(){var a=e.select(this.container).node().getBoundingClientRect(),b={top:20,right:20,bottom:50,left:40},c=a.width-b.left-b.right,d=this.height-b.top-b.bottom;return{margin:b,width:c,height:d,bounds:a,svgWidth:c+b.left+b.right,svgHeight:d+b.top+b.bottom}},x:"undefined",y:"undefined",slider:{rangeBarOpacity:.4,handleScaleFactor:1.6,domainNames:{},scale:{},value:{},mouseMargin:{min:0,max:0},handleMargin:{min:0,max:0},setDomain:function(){this.domainNames=e.scaleBand().domain(j.graph.data.map(function(a){return a.key_as_string})).range([0,j.graph.getDataSize()])},getScale:function(){var a=[0,j.graph.getDataSize()-1],b=[0,j.graph.x.range()[1]-j.graph.x.step()-(j.graph.x.step()-j.graph.x.bandwidth())];return this.scale=e.scaleLinear().range(a).domain(b),this.value=e.scaleLinear().domain(a).range(b),{scale:this.scale,value:this.value}},getCenterPositionOfBar:function(a,b){return{x:this.value(b)+40+j.graph.x.step()/2,y:j.graph.y(a.doc_count)}},getMouseMargin:function(){return this.mouseMargin.min=j.graph.x.step()/2,this.mouseMargin.max=j.graph.x.range()[1]-j.graph.x.step()/2,this.mouseMargin},setInitialHandleMargin:function(){this.handleMargin.min=j.graph.x.step()/2+j.graph.x.step(),this.handleMargin.max=j.graph.x.range()[1]-j.graph.x.step()/2-j.graph.x.step()},setMinHandleMargin:function(a){this.handleMargin.min=a},setMaxHandleMargin:function(a){this.handleMargin.max=a},getHandleMargin:function(){return this.handleMargin},updateHandleMarginOnResize:function(){var a=this.getUpdatedHandlePosition();this.handleMargin.min=a.min+j.graph.x.bandwidth(),this.handleMargin.max=a.max-j.graph.x.bandwidth()},getInitialHandlePosition:function(){var a=this.getScale();return{min:a.value(0)+j.graph.x.step()/2,max:a.value(j.graph.getDataSize()-1)+j.graph.x.step()/2,bottom:j.graph.y.range()[0]+6}},getUpdatedHandlePosition:function(){var a=this.getScale(),b=j.getRange();return{min:a.value(this.domainNames(b[0]))+j.graph.x.step()/2,max:a.value(this.domainNames(b[1]))+j.graph.x.step()/2,bottom:j.graph.y.range()[0]+6}},removeSliderControlls:function(){j.graph.svg.select(".handles").remove()},initSlider:function(){this.setInitialHandleMargin(),this.setDomain(),j.setRange(this.domainNames.domain()[0],this.domainNames.domain()[j.graph.getDataSize()-1])}},calculateDates:function(){return this.dates=this.data.map(function(a){return a.key_as_string}),this.dates},getDates:function(){return this.dates},updateSelectorRangeAndDiagram:function(a){var b=this.svgg.selectAll(".bar"),c=!1;b.each(function(b){e.select(this).raise().classed("selected",!1),b.key_as_string==a[0]&&(c=!0),c&&e.select(this).raise().classed("selected",!0),b.key_as_string==a[1]&&(c=!1)}),j.setRange(a[0],a[1])},setData:function(a){this.data=a},getDataSize:function(){return"undefined"===this.data?0:this.data.length},clearData:function(){this.data="undefined",this.datasetSize=0},setDatasetSize:function(a){this.datasetSize=a},getDatasetSize:function(){return this.datasetSize},drawSlider:function(){var a=this,b=0,c=this.getDates(),d=j.graph.getDimensions(),g=this.slider.getInitialHandlePosition(),h=[c[0],c[c.length-1]],i="M-5.5,-5.5v10l6,5.5l6,-5.5v-10z",k=function(){var d=e.select(this),i=d.select("text"),j=a.dataLengthTrigger,k=a.slider.getScale(),l=a.slider.getMouseMargin(),m=f(k.scale(e.event.x)),n=k.value(m)+a.x.step()/2,o=c[m],p=d.attr("class").includes("start")?"start":"end",q=a.svg.select(".handles .range");m!=b&&e.event.x>l.min&&e.event.x<l.max&&("start"==p?(e.event.x<a.slider.getHandleMargin().max&&(b=f(k.scale(e.event.x)),a.slider.setMinHandleMargin(n+a.x.bandwidth()),d.attr("transform","translate("+n+","+g.bottom+")"),h[0]=o,a.updateSelectorRangeAndDiagram(h)),c.length>j&&0<b&&b<c.length-1?i.text(function(){return h[0]}):i.text("")):(e.event.x>a.slider.getHandleMargin().min&&(b=f(k.scale(e.event.x)),a.slider.setMaxHandleMargin(n-a.x.bandwidth()),d.attr("transform","translate("+n+","+g.bottom+")"),h[1]=o,a.updateSelectorRangeAndDiagram(h)),c.length>j&&0<b&&b<c.length-1?i.text(function(){return h[1]}):i.text(""))),q.attr("x",a.slider.getHandleMargin().min-a.x.bandwidth()).attr("width",a.slider.getHandleMargin().max-a.slider.getHandleMargin().min+2*a.x.bandwidth())};this.slider.initSlider(),this.svg.select(".handles").remove(),e.select(this.container+" svg").append("g").attr("class","handles").attr("transform","translate("+(d.margin.left+(this.x.step()-this.x.bandwidth())/2)+","+d.margin.top+")"),this.svg.select(".handles").append("rect").attr("class","range").attr("x",0).attr("y",0).attr("width",d.width).attr("height",8).attr("opacity",0),this.svg.select(".handles").append("g").attr("class","selector start").attr("transform","translate("+g.min+","+g.bottom+")").attr("font-family","sans-serif").attr("text-anchor","middle").append("path").attr("d",i).attr("transform","scale("+this.slider.handleScaleFactor+")"),this.svg.select(".handles").append("g").attr("class","selector end").attr("transform","translate("+g.max+","+g.bottom+")").attr("font-family","sans-serif").attr("text-anchor","middle").append("path").attr("d",i).attr("transform","scale("+this.slider.handleScaleFactor+")"),this.svg.selectAll(".handles .selector").on("mouseover",function(){e.select(this).style("cursor","e-resize").classed("hovereffekt",!0)}).on("mouseout",function(){e.select(this).classed("hovereffekt",!1)}).call(e.drag().on("start",function(){var b=e.select(this),c=a.svg.select(".handles .range");b.raise().classed("active",!0),c.attr("y",g.bottom-4).attr("x",a.slider.getHandleMargin().min-a.x.bandwidth()).attr("width",a.slider.getHandleMargin().max-a.slider.getHandleMargin().min+2*a.x.bandwidth()).transition().duration(300).attr("opacity",a.slider.rangeBarOpacity),b.append("text").attr("text-anchor","middle").attr("class","handlehovertext").attr("dx",0).attr("dy",37).text("")}).on("drag",k).on("end",function(){var b=e.select(this),c=a.svg.select(".handles .range");c.transition().duration(300).attr("opacity",0),b.classed("active",!1),b.select("text").remove(),j.updateSelectedRange()})),0==this.data.length&&this.slider.removeSliderControlls()},updateSlider:function(){var a=this,b=this.svg.select(".handles .selector.start"),c=this.svg.select(".handles .selector.end"),d=j.getRange(),e=this.slider.getUpdatedHandlePosition(),f=[d[0],d[1]],g=this.svg.select(".handles .range");this.slider.updateHandleMarginOnResize(),this.updateSelectorRangeAndDiagram(f),b.attr("transform","translate("+e.min+","+e.bottom+")"),c.attr("transform","translate("+e.max+","+e.bottom+")"),g.attr("y",e.bottom-4).attr("x",e.min).attr("width",e.max-e.min)},drawGraph:function(){var a=j.graph.getDimensions(),b=this,c=e.select(this.container).append("div").attr("class","tooltip").style("opacity",0);this.x=e.scaleBand().range([0,a.width]).padding(.1),this.y=e.scaleLinear().range([a.height,0]),this.svg=e.select(this.container).append("svg").attr("width",a.svgWidth).attr("height",a.svgHeight),this.svgg=this.svg.append("g").attr("class","bars").attr("transform","translate("+a.margin.left+","+a.margin.top+")"),this.data.forEach(function(a){a.doc_count=+a.doc_count}),this.svgg.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+a.height+")"),this.svgg.append("g").attr("class","axis axis--y"),this.updateGraph(),this.initOnWindowResize()},updateGraph:function(){var a=this,b=this.getDimensions(),c="undefined",g=this.dataLengthTrigger,h=e.select(this.container+" div.tooltip").style("opacity",0),i=function(b,c){var d=a.slider.getCenterPositionOfBar(b,c);h.transition().duration(200).style("opacity",.9),h.html(function(a){return j.setCurrentBarData(a),j.hoverText()}(b)).style("left",d.x-20+"px").style("top",d.y-18+"px"),e.select(this).classed("highlight",!0)},k=function(){h.style("opacity",0).style("left","-1000px").style("top","-1000px"),e.select(this).classed("highlight",!1)};this.svg.select(".empty").remove(),this.x=e.scaleBand().range([0,b.width]).padding(.1),this.x.domain(this.calculateDates()),this.y.domain([0,e.max(a.data,function(a){return a.doc_count})]),this.xAxis=e.axisBottom(this.x).ticks(10).tickValues(this.x.domain().filter(function(b,c){return!!(a.data.length<=g)||0==c||c==a.data.length-1||0==1*b%10})).tickSize(20,0),e.select(this.container+" svg .bars .axis--y").call(e.axisLeft(this.y)),c=this.svgg.selectAll(".bar").data(a.data),c.enter().append("rect").style("opacity",1).attr("class","bar").classed("selected",!0).attr("x",function(b){return a.x(b.key_as_string)}).attr("width",this.x.bandwidth()).attr("y",function(){return a.getDimensions().height}).attr("height",0).on("mouseover",i).on("mouseout",k).transition().duration(300).attr("y",function(b){return a.y(b.doc_count)}).attr("height",function(b){return a.getDimensions().height-a.y(b.doc_count)}),c.attr("x",function(b){return a.x(b.key_as_string)}).attr("y",function(){return a.getDimensions().height}).attr("width",this.x.bandwidth()).attr("height",0).classed("selected",!0).merge(c).on("mouseover",i).on("mouseout",k).transition().duration(300).attr("y",function(b){return a.y(b.doc_count)}).attr("height",function(b){return a.getDimensions().height-a.y(b.doc_count)}),c.exit().transition().duration(300).attr("y",a.getDimensions().height).attr("height",0).style("opacity",0).remove(),e.select(this.container+" svg").attr("width",b.svgWidth),e.select(this.container+" svg .bars .axis--x").attr("transform","translate(0,"+b.height+")").call(this.xAxis).selectAll("text").attr("dy",function(b,c){return a.data.length<=g?0==c||c==a.data.length-1?"1.9em":"0.9em":0==c||c>=f(a.data.length/10+2)-1?"1.9em":"0.9em"}),this.svgg.selectAll(".axis--x .tick line").attr("y2",function(b,c){return a.data.length<=g?0==c||c==a.data.length?32:22:0==c||c>=f(a.data.length/10+2)-1?32:22}),0==a.data.length&&(this.svg.append("g").attr("class","empty").style("opacity",0),this.svg.select(".empty").append("line").attr("x1",a.getDimensions().width/4).attr("x2",a.getDimensions().width/2+a.getDimensions().width/4).attr("y1",a.getDimensions().height/2-30+a.getDimensions().margin.top).attr("y2",a.getDimensions().height/2-30+a.getDimensions().margin.top).style("stroke-width",1).style("stroke","#ccc"),this.svg.select(".empty").append("line").attr("x1",a.getDimensions().width/4).attr("x2",a.getDimensions().width/2+a.getDimensions().width/4).attr("y1",a.getDimensions().height/2+30+a.getDimensions().margin.top).attr("y2",a.getDimensions().height/2+30+a.getDimensions().margin.top).style("stroke-width",1).style("stroke","#ccc"),this.svg.select(".empty").append("text").attr("font-family","sans-serif").attr("text-anchor","middle").attr("x",a.getDimensions().width/2).attr("y",8+a.getDimensions().height/2+a.getDimensions().margin.top).style("font-size",14).text("NO DATA TO DISPLAY"),this.svg.select(".empty").transition().duration(500).style("opacity",1),this.slider.removeSliderControlls())},resize:function(){this.updateGraph(),this.updateSlider()},initOnWindowResize:function(){a(b).resize(function(){0!=j.graph.getDataSize()&&j.graph.resize()})}}};a.extend(g.prototype,{init:function(){j.graph.setData(this.settings.data),j.updateGraphSettings(this.settings),j.graph.drawGraph(),j.graph.drawSlider(),j.updateSelectedRange()},drawAndUpdate:function(){var a=j.graph.getDataSize(),b=0;j.graph.setData(this.settings.data),b=j.graph.getDataSize(),j.clearRange(),j.graph.updateGraph(),0!=b&&j.graph.drawSlider(),j.updateSelectedRange()}}),a.fn.daterangeselect=function(b){if("string"==typeof arguments[0]){var c,d=arguments[0],e=Array.prototype.slice.call(arguments,1);return this.each(function(){if(a.data(this,"plugin_daterangeselect")&&"function"==typeof a.data(this,"plugin_daterangeselect")[d])c=a.data(this,"plugin_daterangeselect")[d].apply(this,e);else if("destroy"===d)a.data(this,"plugin_daterangeselect",null);else throw new Error("Method "+d+" does not exist on jQuery.daterangeselect")}),void 0===c?this:c}return"object"!=typeof b&&b?void 0:this.each(function(){a.data(this,"plugin_daterangeselect")||a.data(this,"plugin_daterangeselect",new g(this,b))})}})(jQuery,window,document,d3);